version: 2

models:
  - name: fct_sales
    description: >
      Transactional fact table (one row = one sale with unique combination of reference_id,
      campaign_name and total_amount). This model:
        - calculates company_revenue (total + rebill – returned)
        - adds order/return dates in three time zones (Kyiv, UTC, New York)
        - calculates days_to_return (difference between return and purchase)
        - removes duplicates by keeping the latest order per (reference_id, campaign_name, total_amount)
        - excludes rows where campaign_name = 'n/a'
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - reference_id
            - campaign_name
            - total_amount
    columns:
      - name: reference_id
        description: Unique sale identifier
        tests:
          - not_null
      - name: product_name
        description: Name of the product
      - name: country
        description: Customer country
      - name: campaign_name
        description: Marketing campaign name (excluding 'n/a')
      - name: source
        description: Sales source
      - name: sales_agent_name
        description: Name of the sales agent
      - name: company_revenue
        description: Company revenue (total + rebill – returned)
      - name: total_rebill_amount
        description: Total rebilled amount
      - name: number_of_rebills
        description: Number of rebills
      - name: returned_amount
        description: Returned amount
      - name: discount_amount
        description: Discount amount applied
      - name: total_amount
        description: Initial total amount
      - name: order_date_kyiv
        description: Order date in Kyiv timezone
      - name: order_date_utc
        description: Order date in UTC timezone
      - name: order_date_ny
        description: Order date in New York timezone
      - name: return_date_kyiv
        description: Return date in Kyiv timezone
      - name: return_date_utc
        description: Return date in UTC timezone
      - name: return_date_ny
        description: Return date in New York timezone
      - name: days_to_return
        description: Days between purchase and return (if return exists)

